<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="app.js"></script>
    <title>Vendegkonyv</title>
</head>

<body>

    <form id="message_form">
        <div class="mb-3">
            <label for="nameInput" class="form-label">Név</label>
            <input type="text" class="form-control" id="nameInput">
        </div>
        <div class="mb-3">
            <label for="messageInput" class="form-label">Üzenet</label>
            <input type="text" class="form-control" id="messageInput">
        </div>
        <button type="submit" class="btn btn-primary">Üzenet elküldése</button>
    </form>

    <table id="dataTable">
        <tr>
            <th>Név</th>
            <th>Üzenet</th>
        </tr>
    </table>

    <script src="https://www.gstatic.com/firebasejs/9.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBDVvy6TKl9afRNt0AhNtWqc-4qzFUGLhc",
            authDomain: "vendegkonyv-94778.firebaseapp.com",
            projectId: "vendegkonyv-94778",
            storageBucket: "vendegkonyv-94778.appspot.com",
            messagingSenderId: "984534326484",
            appId: "1:984534326484:web:65cb90438909af25bd2f41"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        document.getElementById("message_form").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("nameInput").value;
            const message = document.getElementById("messageInput").value;

            db.collection("vendegkonyv").add({
                nev: name,
                uzenet: message,
                ido: new Date(Date.now())
            })
                .then((docRef) => {
                    console.log(docRef.id)
                })
                .catch((error) => {
                    console.error(error)
                })
        });

        //(venegkony!!)
        //var fut = 0
        db.collection("vendegkonyv").onSnapshot((querySnapshot) => {
            const documents = querySnapshot.docs;
            /*
            if (fut != 0) {
                for (let i = 0; i < documents.length; i++) {
                    document.getElementById("").deleteRow(i)
                }
            }
            */

            for (let i = 0; i < documents.length; i++) {
                //const dataList = document.getElementById("dataList")
                const adat = documents[i].data()
                console.log(adat);

                var table = document.getElementById("dataTable");
                var row = table.insertRow(0);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);

                cell1.innerHTML = adat.nev;
                cell2.innerHTML = adat.uzenet;
                cell3.innerHTML = new Date(adat.ido);
                //fut++;
            }
        })
    </script>
</body>

</html>